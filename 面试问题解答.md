# iOS面试指南（2020年6月）参考答案

![](https://gitee.com/zhangferry/Images/raw/master/gitee/headway-5QgIuuBxKwM-unsplash.jpg)

## 面试题

#### Swift

1、Swift中struct和class有什么区别？

答：struct是值引用，更轻量，存放于栈区，class是类型引用，存放于堆区。struct无法继承，class可继承。

2、Swift中的方法调用有哪些形式？

答：直接派发、函数表派发、消息机制派发。派发方式受声明位置，引用类型，特定行为的影响。

参考文章：[深入理解 Swift 派发机制](https://kemchenj.github.io/2016-12-25-1/)

![](https://kemchenj.github.io/images/14826580751015-crunch.png)

3、Swift和OC有什么区别？

|                    | Swift                               | Objective-C          |
| ------------------ | ----------------------------------- | -------------------- |
| 语言特性           | 静态语言，更加安全                  | 动态语言，不那么安全 |
| 语法               | 更精简                              | 冗长                 |
| 命名空间           | 有                                  | 无                   |
| 方法调用           | 直接调用，函数表调用，消息转发      | 消息转发             |
| 泛型/元组/高阶函数 | 有                                  | 无                   |
| 语言效率           | 性能更高，速度更快                  | 略低                 |
| 文件特性           | .swift 单文件                       | .h/.m包含头文件      |
| 编程特性           | 可以更好的实现函数式编程/响应式编程 | 面向对象编程         |

Swift和OC的区别还有很多，这里简要总结这几条。

4、从OC向Swift迁移的时候遇到过什么问题？

可以参考这篇文章：[OC项目转Swift指南](https://juejin.im/post/5e5a4f20518825495a277aa7) 里的混编注意事项。

5、怎么理解面向协议编程？

面向对象是以对象的视角观察整体结构，万物皆为对象。

面向协议则是用协议的方式组织各个类的关系，Swift底层几乎所有类都构建在协议之上。

面向协议能够解决面向对象的菱形继承，横切关注点和动态派发的安全性等问题。

参考喵神的[面向协议编程与 Cocoa 的邂逅 (上)](https://onevcat.com/2016/11/pop-cocoa-1/)

#### OC语法

1、Block是如何实现的？Block对应的数据结构是什么样子的？__block的作用是什么？它对应的数据结构又是什么样子的？

block本质是一个对象，底层用struct实现。

数据结构如下：



__block的作用是让block可以引用该对象。

数据结构如下：



2、GCD中的Block是在堆上还是栈上？

堆上。

3、NSCoding协议是干什么用的？

一种编码协议，归档时和解档时需要依赖该协议定义的编码和解码方法。Foundation和Cocoa Touch中的大部分类都遵循了这个协议，一般被NSKeyedArchiver做自定义对象持久化时使用。

4、KVO的实现原理

利用Runtime生成一个中间对象，让原对象的isa指针指向它，然后重写setter方法，插入willChangeValueForKey和didChangeValueForKey方法。当属性变化时会调用，会调用这两个方法通知到外界属性变化。

5、NSOperation有哪些特性，比着GCD有哪些优点，它有哪些API？

NSOperation是对GCD的封装，具有面向对象的特点，可以更方便的进行封装，可以设置依赖关系。

API可以查看NSOperation文档。

6、NSNotificaiton是同步还是异步的，如果发通知时在子线程，接收在哪个线程？

同步。子线程。

#### UI

1、事件响应链是如何传递的？

屏幕接收点击事件，首先需要确认点击位置，这个是从最低层的window开始的，逐步往上层找，找到点击视图。然后确认当前视图是否可以相应点击，如果能相应将不再往下传递，如果没有相应，会按照确认位置相反的方向，如果一直到window层都没有接收相应，那就不再响应该次点击。

2、什么是异步渲染？

异步渲染就是在子线程进行绘制，然后拿到主线程显示。

3、layoutsubviews是在什么时机调用的？

4、一张图片的展示经历了哪些步骤？

5、什么是离屏渲染，什么情况会导致离屏渲染？

6、CoreAnimation这个框架的作用什么，它跟UIKit的关系是什么？

#### 引用计数

1、ARC方案的原理是什么？它是在什么时候做的隐式添加release操作？

ARC(Automatic Reference Cunting)自动引用计数，意即通过LLVM编译器自动管理对应的引用计数状态。ARC开启时无需再次键入retain或者release代码。

它是在编译阶段添加retain或者release代码的。

2、循环引用有哪些场景，如何避免？

循环引用及两个及以上对象出现引用环，导致对象无法释放的情况。一般在block，delegate，NSTimer时容易出现这个问题。

解决方案就是让环的其中一环节实现弱引用。

3、为什么当我们在使用block时外面是weak 声明一个weakSelf，还要在block内部使用strong再持有一下？

block外界声明weak是为了实现block对对象的弱持有，而里面的作用是为了保证在进到block时不会发生释放。

4、Autoreleasepool是实现机制是什么？它是什么时候释放内部的对象的？它内部的数据结构是什么样的？当我提到哨兵对象时，会继续问哨兵对象的作用是什么，为什么要设计它？

Autoreleasepool的原理是一个双向列表，它会对加入其中的对象实现延迟释放。当Autoreleasepool调用drain方法时会释放内部标记为autorelease的对象。

关于自动释放池的底层探究可以看draveness的这篇[自动释放池的前世今生 ---- 深入解析 autoreleasepool](https://draveness.me/autoreleasepool/ "自动释放池的前世今生 ---- 深入解析 autoreleasepool")

5、哪些对象会放入到Autoreleasepool中？

有两种情况生成的对象会加入到autoreleasepool中：

* 非alloc/new/copy/mutablecopy 开始的方式初始化时。
* id的指针或对象的指针在没有显示指定时

[引用计数带来的一次讨论](https://www.jianshu.com/p/e3690f3e4675 "引用计数带来的一次讨论")

6、weak的实现原理是什么？当引用对象销毁是它是如何管理内部的Hash表的？（这里要参阅weak源码）

runTime会把对weak修饰的对象放到一个全局的哈希表中，用weak修饰的对象的内存地址为key，weak指针为值，在对象进行销毁时，用通过自身地址去哈希表中查找到所有指向此对象的weak指针，并把所有的weak指针置位nil。

#### Runtime

1、消息发送的流程是怎样的？

OC中的方法调用会转化成给对象发送消息，发送消息会调用这个方法：

```
objc_msgSend(receiver, @selector(message))
```

该过程有以下关键步骤：

* 先确定调用方法的类已经都加载完毕，如果没加载完毕的话进行加载

* 从cache中查找方法

* cache中没有找到对应的方法，则到方法列表中查，查到则缓存

* 如果本类中查询到没有结果，则遍历所有父类重复上面的查找过程，直到NSObject

1. 最后都没有找到的方法的话，则执行 `_class_resolveMethod` 让调用者动态添加方法，并重复一轮查询方法的过程
2. 若第六步没有完成动态添加方法，则把 _objc_msgForward_impcache 作为对应 SEL 的方法进行缓存，然后调用 _objc_msgForward_impcache 方法

2、关联对象时什么情况下会导致内存泄露？



3、消息转发的流程是什么？

消息转发是发生在接收者（receiver）没有找到对应的方法（method）的时候，该步骤有如下几个关键步骤：

![](https://gitee.com/zhangferry/Images/raw/master/gitee/20200809211611.png)

* 消息转发的时候，如果是实例方法会走`resolveInstanceMethod:`，如果是类方法会走`resolveClassMethod:`，它们的返回值都是Bool，需要我们确定是否进行转发。
* 如果第一步返回YES，确定转发就会进到下个方法`forwardingTargetForSelector`，这个方法需要我们指定一个被用receiver。
* `methodSignatureForSelector`用于指定方法签名，`forwardInvocation`用于处理Invocation，进行完整转发。
* 如果消息转发也没有处理即为无法处理，会调用`doesNotRecognizeSelector`，引发崩溃。

4、category能否添加属性，为什么？能否添加实例变量，为什么？

可以添加属性，这里的属性指`@property`，但跟类里的`@property`又不一样。正常的`@property`为：实例变量Ivar + Setter + Getter 方法，分类里的@property这三者都没有。

分类是运行时被编译的，这时类的结构已经固定了，所以我们无法添加实例变量。

对于Setter和Getter方法我们可以通过关联对象（Associated Object）进行实现。

5、元类的作用是什么？

元类存储了类方法

6、类方法是存储到什么地方的？类属性呢？

类方法是存储到元类中的。

类属性在Swift用的多些，OC中很少有人用到，但其实它是有的：

```objective-c
@interface Person : NSObject
// 在属性类别中加上class
@property (class, nonatomic, copy) NSString *name;
@end
// 调用方式
NSString *temp = Person.name;
```

需要注意的是跟实例属性不一样，类属性不会自动生成实例变量和setter，getter方法，需要我们手动实现。具体实现方法可以参考这个文章：[Objective-C Class Properties](https://useyourloaf.com/blog/objective-c-class-properties/ "Objective-C Class Properties")



7、讲几个runtime的应用场景

* hook系统方法进行方法交换。
* 了解一个类（闭源）的私有属性和方法。
* 关联对象，实现添加分类属性的功能。
* 修改isa指针，自定义KVO。

#### Runloop

1、讲一下对Runloop的理解？

2、可以用Runloop实现什么功能？

#### 性能优化

1、对TableView进行性能优化有哪些方式？

2、Xcode的Instruments都有哪些调试的工具？

3、讲一下你做过的性能优化的事情。

4、如何检测卡顿，都有哪些方法？

5、缩小包体积有哪些方案？

#### 计算机相关

1、项目编译的流程是什么？手机上的应用程序自点击图标开始到首屏内容展示都经历了哪些步骤？

2、对于基本数据类型，一般是存储到栈中的，它有没有可能存在堆上，什么情况下会存储到堆上？

3、数据库中的事务是什么意思？



4、使用过什么数据库（我回答的Sqlite，Realm），Realm在使用时有哪些注意事项，如何实现批量操作？

5、LRU算法是否了解，如何实现一套LRU算法？

6、知道哪些设计模式，怎么理解设计模式的作用？

7、如果有1000万个Int类型的数字，如何对他们排序？

8、设计一套数据库方案，实现类似微信的搜索关键词能快速检索出包含该字符串的聊天信息，并展示对应数量（聊天记录的数据量较大）。

#### 简历相关问题

1、Lottie实现动画效果的原理是什么？

2、OClint实现静态分析的原理是什么，它是如何做到的？

3、MVVM和MVC有什么区别？

4、静态库和动态库的区别是什么？

5、了解Flutter吗？它有没有使用UIKit？它是如何渲染UI的？

6、二进制重排的核心依据是什么？

7、如何设计一套切换主题的方案？

8、AVPlayer和IJKPlayer有什么区别？用IJKPlayer如何实现一个缓存视频列表每条视频前1s的内容？

9、类似微博的短视频列表，滑动停留播放，如何实现？

10、使用python做过哪些事？如何理解脚本语言？

#### 数据结构与算法

1、什么是Hash表，什么是Hash碰撞，解决Hash碰撞有什么方法？



2、如何遍历二叉树？

二叉树的遍历有三种方式：



3、简述下快速排序的过程，时间复杂度是多少？

快排的思想是通过一趟排序将要排序的数据分割成独立的两部分，其中一部分的所有数据都比另外一部分的所有数据都要小，然后再按此方法对这两部分数据分别进行快速排序，整个排序过程可以递归进行。

一个简单的Swift实现方式如下：

```swift
func quicksort<T: Comparable>(_ a: [T]) -> [T] {
  guard a.count > 1 else { return a }

  let pivot = a[a.count/2]
  let less = a.filter { $0 < pivot }
  let equal = a.filter { $0 == pivot }
  let greater = a.filter { $0 > pivot }

  return quicksort(less) + equal + quicksort(greater)
}
```

快速排序是有好几种的，他们的区别在于如何实现filter和分区基准值的选取。

快排的时间复杂度是`O(nlogn)`，空间复杂度是`O(logn)`

4、有一个整数数组，如何只遍历一遍就实现让该数组奇数都在前面，偶数都在后面？

这个是《剑指offer》里的一道题，leedcode也有对应题目：[剑指offer 21](https://leetcode-cn.com/problems/diao-zheng-shu-zu-shun-xu-shi-qi-shu-wei-yu-ou-shu-qian-mian-lcof/ "剑指offer 21")

这个相对比较简单，因为不要求有序，可以采用收尾遍历的方式，进行交换，我这有个参考答案：

```swift
func sorted( _ nums: inout [Int]) -> [Int] {
    guard !nums.isEmpty else {
        return []
    }
    var start = 0
    var end = nums.count - 1
    while start < end {
        if nums[start] % 2 != 0 {
            start += 1
            continue
        }
        if nums[end] % 2 == 0 {
            end -= 1
            continue
        }
        (nums[start], nums[end]) = (nums[end], nums[start])
    }
    return nums
}
```



5、假设你正在爬楼梯。需要 n 阶你才能到达楼顶。每次你可以爬 1 或 2 个台阶。你有多少种不同的方法可以爬到楼顶呢？

[leetcode 20](https://leetcode-cn.com/problems/climbing-stairs/ "leetcode 20")

6、给出一个 32 位的有符号整数，你需要将这个整数中每位上的数字进行反转。

[leetcode 7](https://leetcode-cn.com/problems/reverse-integer/ "leetcode7")

7、有红、黄、蓝三种颜色的气球。在牛客王国，1个红气球+1个黄气球+1个蓝气球可以兑换一张彩票。

2个红气球+1个黄气球可以兑换1个蓝气球。

2个黄气球+1个蓝气球可以兑换1个红气球。

2个蓝气球+1个红气球可以兑换1个黄气球。

现在牛牛有a个红气球，b个黄气球， c个蓝气球，牛牛想知道自己最多可以兑换多少张彩票。







![](https://gitee.com/zhangferry/Images/raw/master/gitee/20200719185749.png)