#ã€è¯‘ã€‘æ›´å¥½çš„äº†è§£Xcodeæ„å»ºç³»ç»Ÿ

åŸæ–‡ï¼šhttps://medium.com/flawless-app-stories/xcode-build-system-know-it-better-96936e7f52a

ä½œè€…ï¼šVarun Tomar



ä¸€ä¸ªç¨‹åºåœ¨è¿è¡Œåˆ°ä¸€å°è®¾å¤‡ä¹‹å‰æ˜¯ç»å†äº†å¾ˆå¤šè½¬æ¢çš„æ­¥éª¤çš„ã€‚å’Œå…¶å®ƒçš„ç¼–ç¨‹è¯­è¨€å¤„ç†ç³»ç»Ÿä¸€æ ·ï¼ŒXcodeæ„å»ºç³»ç»Ÿä¸ºäº†ç¡®ä¿æ‰§è¡Œé¡ºåºå’Œå„ç§ä¾èµ–åº“ï¼Œéœ€è¦è¿è¡Œå¾ˆå¤šå‘½ä»¤è¡ŒæŒ‡ä»¤ï¼Œä¼ é€’å„ç§å„æ ·çš„å‚æ•°ã€‚æ•´ä¸ªæ„å»ºè¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹äº”ä¸ªé˜¶æ®µï¼š

1ã€é¢„å¤„ç†

2ã€ç¼–è¯‘

3ã€æ±‡ç¼–

4ã€é“¾æ¥

5ã€åŠ è½½



## é¢„å¤„ç†

é¢„å¤„ç†çš„ç›®çš„æ˜¯æŠŠæˆ‘ä»¬çš„ç¨‹åºè½¬æ¢æˆèƒ½è¢«ç¼–è¯‘å™¨è¯†åˆ«çš„å½¢å¼ã€‚å®ƒç”¨å®çš„å®šä¹‰æ›¿æ¢å®ï¼Œå‘ç°ä¾èµ–å…³ç³»å¹¶è§£æé¢„å¤„ç†å™¨æŒ‡ä»¤ã€‚å¦‚æœSwiftç¼–è¯‘å™¨æ²¡æœ‰é¢„å¤„ç†å™¨ï¼Œæˆ‘ä»¬åˆ™ä¸èƒ½åœ¨Swifté¡¹ç›®ä¸­å®šä¹‰å®å‘½ä»¤ã€‚åœ¨Xcode8ä¸­æ˜¯å…è®¸æˆ‘ä»¬é€šè¿‡`Build Setting`ä¸­çš„`SWIFT_ACTIVE_COMPILATION_CONDITIONS`å®šä¹‰é¢„å¤„ç†å™¨æ ‡è®°ä½çš„ã€‚å®ƒè·ŸOCä¸­çš„é¢„å¤„ç†å™¨å®å®šä¹‰æ˜¯ä¸€è‡´çš„ã€‚

![](https://raw.githubusercontent.com/zhangferry/Images/master/blog/20200624180433.png)



## ç¼–è¯‘å™¨

ç¼–è¯‘æ˜¯æ•´ä¸ªè¿‡ç¨‹ä¸­éå¸¸é‡è¦çš„ä¸€ç¯ã€‚ç¼–è¯‘å™¨æ˜¯ä¸€ä¸ªç¨‹åºï¼Œå®ƒæŠŠé«˜çº§è¯­è¨€åƒæ˜¯Swift&Objective Cè½¬æ¢æˆä½çº§è¯­è¨€ï¼Œåƒæ˜¯objectæ–‡ä»¶ã€‚åœ¨iOSä¸­æœ‰ä¸¤ç±»ç¼–è¯‘å™¨ã€Clange & swiftcã€ã€‚è¯¥è¿‡ç¨‹çš„æŠ½è±¡æè¿°ä¸ºï¼š

![img](https://miro.medium.com/max/450/1*sryDiLA0zu5EhrPCUjZBew.png)

**æ³¨æ„**ï¼šç¼–è¯‘å™¨åŒ…å«ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼šå‰ç«¯å’Œåç«¯ã€‚Clangeæ˜¯C/C++/Objective-Cçš„ç¼–è¯‘å‰ç«¯ï¼Œswiftcæ˜¯Swiftçš„ç¼–è¯‘å‰ç«¯ï¼ŒLLVMæ˜¯åç«¯ã€‚è¿™äº›ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿æ˜¯ä»€ä¹ˆï¼ŒLLVMæ˜¯ä»å“ªé‡Œæ¥çš„?

![img](https://miro.medium.com/max/500/1*cb10Q6m1P8eHbU74uqyocQ.gif)

ä¸è¦æ‹…å¿ƒğŸ˜‰ï¼Œæˆ‘å°†ä¼šå¯¹å®ƒè¿›è¡Œç®€æ˜æ‰¼è¦çš„ä»‹ç»ï¼Œå°½ç®¡è¿™å¯èƒ½è¦å•ç‹¬å‡ºä¸€ç¯‡æ–‡ç« è¯´æ˜å…¶ä¸­ç»†èŠ‚ï¼ˆä¹‹åçš„æ–‡ç« ï¼Œæˆ‘ä¼šå°±è¿™æ–¹é¢å†™ä¸€ç¯‡æ–‡ç« ï¼‰ã€‚

> LLVM(*Low Level Virtual Machine*)æ˜¯ä¸€ä¸ªåç«¯ç¼–è¯‘å™¨ï¼Œç”¨äºåœ¨å…¶ä¸Šæ„å»ºç¼–è¯‘å™¨ã€‚å®ƒå¤„ç†ä¼˜åŒ–å’Œç”Ÿäº§é€‚åº”ç›®æ ‡æ¶æ„(ARMã€x86)çš„ä»£ç ã€‚CLang/Swiftcæ˜¯ä¸€ä¸ªå‰ç«¯ç¼–è¯‘å™¨ï¼Œå¯ä»¥è§£æCã€c++ã€Objective Cå’ŒSwiftä»£ç ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºé€‚åˆLLVMçš„ä¸­é—´è¡¨ç¤º(IR)ã€‚åœ¨æœ¬æ–‡åé¢ï¼Œæ‚¨å°†æ›´å¥½åœ°ç†è§£å®ƒã€‚



è®©æˆ‘ä»¬æ›´ç»†ç²’åº¦çš„ç†è§£ä¸‹Swiftè¯­è¨€çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œå‚è€ƒä¸‹é¢çš„å›¾ç¤ºï¼š

![img](https://miro.medium.com/max/2058/1*wzgnQ32uL0GGi3XrX4rlTA.png)



**æ¥ä¸‹æ¥ä»‹ç»Swiftç¼–è¯‘å™¨ç¤ºå¦‚ä½•ä¸€æ­¥ä¸€æ­¥å·¥ä½œçš„ï¼š**

1ã€Swiftä»£ç è§£ææˆAST **(Abstract Syntax TreeæŠ½è±¡è¯­æ³•æ ‘)**ã€‚ASTæ˜¯ä¸€ä¸ªä»£è¡¨æºç ç»“æ„çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªç»“æ„ã€‚å®ƒæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Œè®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ç†è§£å®ƒã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å°†è¦è¿›è¡Œåˆ†æçš„Swiftä»£ç ï¼š

```swift
//
//  Test.swift
//
//  Created by Varun Tomar
//  Copyright Â© 2020 Varun Tomar. All rights reserved.
//

import Foundation

class Bird {
  func fly() { }
}

func isFlyHigh(bird: Bird) -> Bool { return false }

class Sparrow: Bird {
  override func fly() { }
  func add(x: Int, y: Int) -> Int { return x + y }
}
```

æˆ‘ä»¬å¯ä»¥å°†è¿™æ®µä»£ç è½¬æ¢æˆæŠ½è±¡è¯­æ³•æ ‘æ ¼å¼å†…å®¹ï¼Œè¿™éœ€è¦è¿è¡Œ`xcrun swiftc -dump-ast Test.swift`ã€‚



